#!/bin/bash

set -e

APP_NAME="Dictum"
DMG_NAME="$APP_NAME-1.0"
DMG_TEMP="$DMG_NAME-temp"
VOLUME_NAME="$APP_NAME"

echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ DMG –¥–ª—è $APP_NAME..."
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ .app
if [ ! -d "$APP_NAME.app" ]; then
    echo "‚ùå $APP_NAME.app –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ ./build.sh"
    exit 1
fi

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã
rm -f "$DMG_NAME.dmg"
rm -rf "$DMG_TEMP"

# –°–æ–∑–¥–∞—ë–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
mkdir -p "$DMG_TEMP"

# –ö–æ–ø–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
echo "üìÅ –ö–æ–ø–∏—Ä—É–µ–º $APP_NAME.app..."
cp -r "$APP_NAME.app" "$DMG_TEMP/"

# –°–æ–∑–¥–∞—ë–º —Å–∏–º–ª–∏–Ω–∫ –Ω–∞ Applications
ln -s /Applications "$DMG_TEMP/Applications"

# –°–æ–∑–¥–∞—ë–º README
cat > "$DMG_TEMP/–£–°–¢–ê–ù–û–í–ö–ê.txt" << 'EOF'
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    DICTUM                                 ‚ïë
‚ïë         –£–º–Ω—ã–π –≤–≤–æ–¥ —Å –ò–ò –¥–ª—è macOS                        ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

–£–°–¢–ê–ù–û–í–ö–ê:
1. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ Dictum.app –≤ –ø–∞–ø–∫—É Applications (–ü—Ä–æ–≥—Ä–∞–º–º—ã)
2. –û—Ç–∫—Ä–æ–π—Ç–µ Dictum –∏–∑ –ø–∞–ø–∫–∏ –ü—Ä–æ–≥—Ä–∞–º–º—ã
3. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ macOS –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:
   - –û—Ç–∫—Ä–æ–π—Ç–µ –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
   - –ù–∞–∂–º–∏—Ç–µ "–í—Å—ë —Ä–∞–≤–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å"

–ì–û–†–Ø–ß–ò–ï –ö–õ–ê–í–ò–®–ò:
‚Ä¢ Cmd + ` ‚Äî –æ—Ç–∫—Ä—ã—Ç—å/–∑–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –≤–≤–æ–¥–∞
‚Ä¢ Enter ‚Äî –≤—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –∏ –∑–∞–∫—Ä—ã—Ç—å
‚Ä¢ Cmd + , ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ê–í–¢–û–ó–ê–ü–£–°–ö:
–°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –û—Å–Ω–æ–≤–Ω—ã–µ ‚Üí –û–±—ä–µ–∫—Ç—ã –≤—Ö–æ–¥–∞ ‚Üí –î–æ–±–∞–≤–∏—Ç—å Dictum

–£–î–ê–õ–ï–ù–ò–ï:
–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ Dictum.app –∏–∑ –ø–∞–ø–∫–∏ –ü—Ä–æ–≥—Ä–∞–º–º—ã –≤ –∫–æ—Ä–∑–∏–Ω—É

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
EOF

# –°–æ–∑–¥–∞—ë–º DMG
echo "üíø –°–æ–∑–¥–∞—ë–º DMG..."
hdiutil create -volname "$VOLUME_NAME" \
    -srcfolder "$DMG_TEMP" \
    -ov -format UDZO \
    "$DMG_NAME.dmg"

# –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
rm -rf "$DMG_TEMP"

# –†–∞–∑–º–µ—Ä DMG
DMG_SIZE=$(du -h "$DMG_NAME.dmg" | cut -f1)

echo ""
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo "‚úÖ $DMG_NAME.dmg —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!"
echo "üì¶ –†–∞–∑–º–µ—Ä: $DMG_SIZE"
echo ""
echo "–§–∞–π–ª –≥–æ—Ç–æ–≤ –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è:"
echo "  $(pwd)/$DMG_NAME.dmg"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
